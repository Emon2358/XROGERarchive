# .github/workflows/convert-ram-to-mp3.yml
name: Convert RAM to MP3

on:
  push:
    paths:
      - '**/*.ram'
  workflow_dispatch:

jobs:
  convert:
    runs-on: ubuntu-latest

    steps:
      # ãƒªãƒã‚¸ãƒˆãƒªã‚’ãƒ•ãƒ«ã‚¯ãƒ­ãƒ¼ãƒ³
      - name: Checkout repository
        uses: actions/checkout@v3
        with:
          fetch-depth: 0

      # ffmpeg ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
      - name: Install FFmpeg
        run: |
          sudo apt-get update
          sudo apt-get install -y ffmpeg

      # .ram â†’ .mp3 å¤‰æ›ï¼ˆã‚«ãƒãƒ¼ã‚¢ãƒ¼ãƒˆã‚’ãƒ“ãƒ‡ã‚ªã‚¹ãƒˆãƒªãƒ¼ãƒ ã¨ã—ã¦ã‚³ãƒ”ãƒ¼ï¼‰
      - name: Convert .ram to .mp3
        run: |
          mkdir -p converted
          find . -type f -name '*.ram' | while read f; do
            out="converted/$(basename "${f%.*}.mp3")"
            ffmpeg -y -i "$f" \
              -codec:a libmp3lame -q:a 2 \
              -codec:v copy \
              -map 0 \
              -id3v2_version 3 \
              "$out"
          done

      # ç”Ÿæˆã•ã‚ŒãŸ MP3 ã‚’ã‚³ãƒŸãƒƒãƒˆï¼†ãƒ—ãƒƒã‚·ãƒ¥
      - name: Auto commit & push converted MP3
        uses: stefanzweifel/git-auto-commit-action@v4
        with:
          commit_message: "ğŸ”„ Convert RAM to MP3"
          file_pattern: converted/**/*.mp3
          push: true
